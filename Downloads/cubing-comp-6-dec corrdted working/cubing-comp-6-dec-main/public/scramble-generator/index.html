<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3x3 Scramble Generator - The Cubing Hub</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .scramble-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scramble-moves {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-items: center;
        }

        .move-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .move-image {
            width: 50px;
            height: 62px;
            object-fit: contain;
            border-radius: 5px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .move-image:hover {
            transform: scale(1.05);
        }

        .move-image.double-move {
            box-shadow: 0 0 0 3px #ffd700, 0 1px 4px rgba(0, 0, 0, 0.15);
            background: #fffacd;
        }

        .move-label {
            font-size: 0.8em;
            font-weight: 600;
            color: #555;
            text-align: center;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 35px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .copy-btn {
            background: #48bb78;
            color: white;
        }

        .copy-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .copy-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .copied {
            background: #2d7a4f !important;
        }

        .export-btn {
            background: #e53e3e;
            color: white;
        }

        .export-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .export-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .rounds-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .round-group {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .round-header {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .scrambles-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .scramble-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .scramble-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .scramble-item .scramble-moves {
            gap: 6px;
        }

        .scramble-item .move-image {
            width: 40px;
            height: 50px;
        }

        .scramble-item .move-image.double-move {
            box-shadow: 0 0 0 2px #ffd700, 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        .selectors {
            display: flex;
            align-items: center;
            gap: 30px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .selector-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selector-group label {
            font-weight: 600;
            color: #555;
        }

        .selector-group select {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-size: 1em;
            cursor: pointer;
            background: white;
            transition: border-color 0.2s;
        }

        .selector-group select:hover {
            border-color: #667eea;
        }

        .selector-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .empty-state {
            font-size: 1.2em;
            color: #999;
            text-align: center;
        }

        .image-error {
            background: #fed7d7;
            border: 1px solid #fc8181;
            color: #c53030;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .move-image {
                width: 35px;
                height: 44px;
            }

            .scramble-item .move-image {
                width: 30px;
                height: 38px;
            }

            .scramble-moves {
                gap: 5px;
            }

            .scramble-item .scramble-moves {
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Move image mapping - using relative paths
        const MOVE_IMAGES = {
            'R': './assets/notations/R.png',
            "R'": './assets/notations/R\'.png',
            'L': './assets/notations/L.png',
            "L'": './assets/notations/L\'.png',
            'U': './assets/notations/U.png',
            "U'": './assets/notations/U\'.png',
            'D': './assets/notations/D.png',
            "D'": './assets/notations/D\'.png',
            'F': './assets/notations/F.png',
            "F'": './assets/notations/F\'.png',
            'B': './assets/notations/B.png',
            "B'": './assets/notations/B\'.png'
        };

        const CUBE_CONFIGS = {
            '2x2': {
                moves: ['R', 'U', 'F'],
                length: 9,
                description: '2x2 Cube (WCA Standard)'
            },
            '3x3': {
                moves: ['R', 'L', 'U', 'D', 'F', 'B'],
                length: 20,
                description: '3x3 Cube (WCA Standard)'
            },
            '4x4': {
                moves: ['R', 'L', 'U', 'D', 'F', 'B', 'Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw'],
                length: 40,
                description: '4x4 Cube (WCA Standard)'
            },
            '5x5': {
                moves: ['R', 'L', 'U', 'D', 'F', 'B', 'Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw', 'M', 'E', 'S'],
                length: 60,
                description: '5x5 Cube (WCA Standard)'
            }
        };

        const generateScramble = (cubeType = '3x3') => {
            const config = CUBE_CONFIGS[cubeType];
            const moves = config.moves;
            const length = config.length;
            const modifiers = ['', "'", '2'];
            const scramble = [];
            let lastMove = '';

            const getGroup = (move) => {
                if (move === 'R' || move === 'Rw') return 'R';
                if (move === 'L' || move === 'Lw') return 'L';
                if (move === 'U' || move === 'Uw') return 'U';
                if (move === 'D' || move === 'Dw') return 'D';
                if (move === 'F' || move === 'Fw') return 'F';
                if (move === 'B' || move === 'Bw') return 'B';
                if (move === 'M') return 'M';
                if (move === 'E') return 'E';
                if (move === 'S') return 'S';
                return move;
            };

            for (let i = 0; i < length; i++) {
                let move;
                do {
                    move = moves[Math.floor(Math.random() * moves.length)];
                } while (move === lastMove);

                const modifier = modifiers[Math.floor(Math.random() * modifiers.length)];
                scramble.push(move + modifier);
                lastMove = move;
            }

            return scramble.join(' ');
        };

        const ScrambleGenerator = () => {
            const [rounds, setRounds] = useState([]);
            const [cubeType, setCubeType] = useState('3x3');
            const [numRounds, setNumRounds] = useState(1);
            const [copied, setCopied] = useState(false);
            const [imageError, setImageError] = useState(false);
            const [imageCache, setImageCache] = useState({});

            const handleGenerate = () => {
                const newRounds = [];
                for (let round = 0; round < numRounds; round++) {
                    const roundScrambles = [];
                    for (let i = 0; i < 6; i++) {
                        roundScrambles.push(generateScramble(cubeType));
                    }
                    newRounds.push(roundScrambles);
                }
                setRounds(newRounds);
                setCopied(false);
                setImageError(false);
            };

            const getMoveImageSrc = (move) => {
                if (move.includes('2')) {
                    const baseMove = move.replace('2', '');
                    return MOVE_IMAGES[baseMove];
                }
                return MOVE_IMAGES[move];
            };

            const handleCopy = () => {
                let allText = '';
                for (let roundIdx = 0; roundIdx < rounds.length; roundIdx++) {
                    allText += `Round ${roundIdx + 1}:\n`;
                    for (let i = 0; i < rounds[roundIdx].length; i++) {
                        allText += `Scramble ${i + 1}: ${rounds[roundIdx][i]}\n`;
                    }
                    allText += '\n';
                }
                navigator.clipboard.writeText(allText);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const handleExportPDF = async () => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                // Add title
                pdf.setFontSize(20);
                pdf.setTextColor(102, 126, 234);
                pdf.text(`${CUBE_CONFIGS[cubeType].description} - The Cubing Hub`, 105, 20, { align: 'center' });

                pdf.setFontSize(10);
                pdf.setTextColor(100, 100, 100);
                pdf.text(`${numRounds} Round${numRounds > 1 ? 's' : ''} - ${new Date().toLocaleDateString()}`, 105, 27, { align: 'center' });

                let yPosition = 45;

                const loadImageAsBase64 = async (move) => {
                    // Use preloaded image from cache
                    if (imageCache[move]) {
                        return imageCache[move];
                    }

                    // Fallback: try to load if not in cache
                    try {
                        const imagePath = MOVE_IMAGES[move];
                        const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
                        const fullUrl = imagePath.startsWith('http') ? imagePath : baseUrl + imagePath.replace('./', '');

                        const response = await fetch(fullUrl);
                        const blob = await response.blob();
                        return new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(blob);
                        });
                    } catch (error) {
                        console.error(`Failed to load image: ${move}`, error);
                        throw error;
                    }
                };

                for (let roundIdx = 0; roundIdx < rounds.length; roundIdx++) {
                    const scrambles = rounds[roundIdx];

                    // Add round header
                    pdf.setFontSize(16);
                    pdf.setTextColor(102, 126, 234);
                    pdf.text(`Round ${roundIdx + 1}`, 20, yPosition);
                    yPosition += 12;

                    // Add separator
                    pdf.setDrawColor(102, 126, 234);
                    pdf.setLineWidth(1);
                    pdf.line(20, yPosition - 2, 190, yPosition - 2);
                    yPosition += 8;

                    for (let i = 0; i < scrambles.length; i++) {
                        pdf.setFontSize(12);
                        pdf.setTextColor(102, 126, 234);
                        pdf.text(`Scramble ${i + 1}:`, 20, yPosition);

                        yPosition += 10;

                        const moves = scrambles[i].split(' ');
                        let xPosition = 20;
                        const imageWidth = 12;
                        const imageHeight = 15;
                        const imageGap = 2;

                        for (let j = 0; j < moves.length; j++) {
                            const move = moves[j];
                            // For double moves (R2), use just R. For primes (R'), use R'
                            const lookupKey = move.includes('2') ? move.replace('2', '') : move;

                            try {
                                const base64Image = await loadImageAsBase64(lookupKey);
                                pdf.addImage(base64Image, 'PNG', xPosition, yPosition, imageWidth, imageHeight);

                                // Add golden border for double moves
                                if (move.includes('2')) {
                                    pdf.setDrawColor(255, 215, 0);
                                    pdf.setLineWidth(0.5);
                                    pdf.rect(xPosition - 0.5, yPosition - 0.5, imageWidth + 1, imageHeight + 1);
                                }

                                pdf.setFontSize(8);
                                pdf.setTextColor(80, 80, 80);
                                pdf.text(move, xPosition + imageWidth/2, yPosition + imageHeight + 3, { align: 'center' });

                                xPosition += imageWidth + imageGap;

                                if (xPosition > 180) {
                                    xPosition = 20;
                                    yPosition += 22;
                                }
                            } catch (error) {
                                console.error('Error loading image for move ' + move + ':', error);
                                pdf.setFontSize(9);
                                pdf.setTextColor(200, 0, 0);
                                pdf.text('‚ùå ' + move, xPosition, yPosition + 8);
                                pdf.setTextColor(80, 80, 80);
                                xPosition += 15;
                            }
                        }

                        yPosition += 25;

                        if (i < scrambles.length - 1) {
                            pdf.setDrawColor(233, 236, 239);
                            pdf.line(20, yPosition, 190, yPosition);
                            yPosition += 10;
                        }

                        if (yPosition > 240 && i < scrambles.length - 1) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                    }

                    // Add space between rounds
                    if (roundIdx < rounds.length - 1) {
                        yPosition += 15;
                        if (yPosition > 240) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                    }
                }

                const pageCount = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(9);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text(`Generated by The Cubing Hub - Page ${i} of ${pageCount}`, 105, 285, { align: 'center' });
                }

                pdf.save(`cubing-hub-scrambles-${new Date().toISOString().split('T')[0]}.pdf`);
            };

            useEffect(() => {
                // Preload all images as base64
                const preloadImages = async () => {
                    const cache = {};
                    const imageKeys = Object.keys(MOVE_IMAGES);

                    for (const key of imageKeys) {
                        try {
                            const imagePath = MOVE_IMAGES[key];
                            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
                            const fullUrl = imagePath.startsWith('http') ? imagePath : baseUrl + imagePath.replace('./', '');

                            const response = await fetch(fullUrl);
                            const blob = await response.blob();
                            const reader = new FileReader();

                            await new Promise((resolve, reject) => {
                                reader.onload = () => {
                                    cache[key] = reader.result;
                                    resolve();
                                };
                                reader.onerror = reject;
                                reader.readAsDataURL(blob);
                            });
                        } catch (error) {
                            console.error(`Failed to preload image: ${key}`, error);
                        }
                    }

                    setImageCache(cache);
                    console.log('Images preloaded:', Object.keys(cache).length);
                };

                preloadImages();
                handleGenerate();
            }, []);

            return (
                <div className="container">
                    <h1>üé≤ {CUBE_CONFIGS[cubeType].description}</h1>
                    <p className="subtitle">The Cubing Hub</p>

                    {imageError && (
                        <div className="image-error">
                            ‚ö†Ô∏è Images not found. Please ensure notation images are in the assets/notations/ folder.
                        </div>
                    )}

                    <div className="selectors">
                        <div className="selector-group">
                            <label htmlFor="cube-type">Cube Type:</label>
                            <select
                                id="cube-type"
                                value={cubeType}
                                onChange={(e) => {
                                    setCubeType(e.target.value);
                                    handleGenerate();
                                }}
                            >
                                <option value="2x2">2x2 Cube</option>
                                <option value="3x3">3x3 Cube</option>
                                <option value="4x4">4x4 Cube</option>
                                <option value="5x5">5x5 Cube</option>
                            </select>
                        </div>
                        <div className="selector-group">
                            <label htmlFor="num-rounds">Rounds:</label>
                            <select
                                id="num-rounds"
                                value={numRounds}
                                onChange={(e) => {
                                    setNumRounds(Number(e.target.value));
                                    handleGenerate();
                                }}
                            >
                                {[1, 2, 3, 4, 5, 6, 7, 8].map(n => (
                                    <option key={n} value={n}>{n} Round{n > 1 ? 's' : ''}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    <div className="controls">
                        <button className="generate-btn" onClick={handleGenerate}>
                            üîÑ Generate Scrambles
                        </button>
                        <button
                            className={`copy-btn ${copied ? 'copied' : ''}`}
                            onClick={handleCopy}
                            disabled={rounds.length === 0}
                        >
                            {copied ? '‚úì Copied!' : 'üìã Copy All'}
                        </button>
                        <button
                            className="export-btn"
                            onClick={handleExportPDF}
                            disabled={rounds.length === 0}
                        >
                            üìÑ Export to PDF
                        </button>
                    </div>

                    <div className="rounds-container">
                        {rounds.length === 0 ? (
                            <div className="empty-state">Click "Generate Scrambles" to get started</div>
                        ) : (
                            rounds.map((roundScrambles, roundIdx) => (
                                <div key={roundIdx} className="round-group">
                                    <div className="round-header">Round {roundIdx + 1}</div>
                                    <div className="scrambles-container">
                                        {roundScrambles.map((scramble, idx) => (
                                            <div key={idx} className="scramble-item">
                                                <div className="scramble-number">Scramble {idx + 1}</div>
                                                <div className="scramble-moves">
                                                    {scramble.split(' ').map((move, moveIdx) => (
                                                        <div key={moveIdx} className="move-card">
                                                            <img
                                                                src={getMoveImageSrc(move)}
                                                                alt={move}
                                                                className={`move-image ${move.includes('2') ? 'double-move' : ''}`}
                                                                onError={() => setImageError(true)}
                                                            />
                                                            <div className="move-label">{move}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ScrambleGenerator />, document.getElementById('root'));
    </script>
</body>
</html>
